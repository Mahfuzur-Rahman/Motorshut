@model MotorsHut.Models.Admin.CarFormViewModel
@{
    ViewData["Title"] = "Add Car";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<style>
    :root {
        --amber:      #f59e0b;
        --amber-deep: #d97706;
        --amber-glow: rgba(245,158,11,0.1);
        --bg:         #06090f;
        --surface:    #0d1220;
        --surface2:   #111827;
        --border:     rgba(255,255,255,0.065);
        --text:       #e2e8f0;
        --muted:      #64748b;
        --muted2:     #94a3b8;
        --green:      #10b981;
        --red:        #f87171;
    }

    /* ?? Page header ?????????????????????????????? */
    .ac-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1.6rem;
    }

    .ac-header__title {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 2rem;
        letter-spacing: 0.04em;
        color: var(--text);
        line-height: 1;
        margin: 0 0 0.25rem;
    }

    .ac-header__sub {
        font-size: 0.82rem;
        color: var(--muted);
    }

    .ac-back {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        font-size: 0.82rem;
        font-weight: 500;
        color: var(--muted2);
        text-decoration: none;
        padding: 0.45rem 0.9rem;
        border: 1px solid var(--border);
        border-radius: 8px;
        background: rgba(255,255,255,0.03);
        transition: color 0.18s, background 0.18s, border-color 0.18s;
        align-self: flex-start;
    }

    .ac-back:hover {
        color: var(--text);
        background: rgba(255,255,255,0.06);
        border-color: rgba(255,255,255,0.12);
    }

    /* ?? Form panel ??????????????????????????????? */
    .ac-panel {
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: 16px;
        overflow: hidden;
    }

    .ac-panel__head {
        padding: 1rem 1.4rem;
        border-bottom: 1px solid var(--border);
        background: rgba(255,255,255,0.018);
        display: flex;
        align-items: center;
        gap: 0.7rem;
    }

    .ac-panel__icon {
        width: 30px;
        height: 30px;
        background: var(--amber-glow);
        border: 1px solid rgba(245,158,11,0.2);
        border-radius: 8px;
        display: grid;
        place-items: center;
        color: var(--amber);
        flex-shrink: 0;
    }

    .ac-panel__title {
        font-family: 'Bebas Neue', sans-serif;
        font-size: 1.1rem;
        letter-spacing: 0.06em;
        color: var(--text);
        margin: 0;
    }

    .ac-panel__body {
        padding: 1.6rem 1.4rem;
    }

    /* ?? Field styles ????????????????????????????? */

    /* Override Bootstrap form controls for dark theme */
    .ac-panel .form-label {
        font-size: 0.75rem;
        font-weight: 600;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: var(--muted2);
        margin-bottom: 0.4rem;
    }

    .ac-panel .form-control,
    .ac-panel .form-select {
        background: rgba(255,255,255,0.04) !important;
        border: 1px solid var(--border) !important;
        border-radius: 9px !important;
        color: var(--text) !important;
        font-family: 'DM Sans', sans-serif;
        font-size: 0.9rem;
        padding: 0.62rem 0.9rem;
        transition: border-color 0.18s, background 0.18s, box-shadow 0.18s;
    }

    .ac-panel .form-control::placeholder { color: #334155 !important; }

    .ac-panel .form-control:focus,
    .ac-panel .form-select:focus {
        background: rgba(245,158,11,0.04) !important;
        border-color: rgba(245,158,11,0.4) !important;
        box-shadow: 0 0 0 3px rgba(245,158,11,0.07) !important;
        color: var(--text) !important;
        outline: none;
    }

    .ac-panel .form-select option {
        background: #0d1220;
        color: var(--text);
    }

    .ac-panel textarea.form-control { resize: vertical; min-height: 90px; }

    .ac-panel .form-check-input {
        background-color: rgba(255,255,255,0.06);
        border: 1px solid rgba(255,255,255,0.2);
        width: 1rem;
        height: 1rem;
    }

    .ac-panel .form-check-input:checked {
        background-color: var(--amber);
        border-color: var(--amber);
    }

    .ac-panel .form-check-label {
        font-size: 0.88rem;
        color: var(--muted2);
    }

    /* Validation */
    .ac-panel .text-danger,
    .ac-panel .field-validation-error {
        font-size: 0.75rem;
        color: var(--red) !important;
        margin-top: 0.25rem;
        display: block;
    }

    .ac-panel .input-validation-error {
        border-color: rgba(248,113,113,0.45) !important;
        background: rgba(248,113,113,0.04) !important;
    }

    /* ?? Section dividers inside the form ????????? */
    .ac-section {
        margin-bottom: 1.8rem;
    }

    .ac-section__label {
        font-size: 0.68rem;
        font-weight: 700;
        letter-spacing: 0.14em;
        text-transform: uppercase;
        color: var(--muted);
        padding-bottom: 0.6rem;
        border-bottom: 1px solid var(--border);
        margin-bottom: 1.1rem;
    }

    /* ?? Form actions ????????????????????????????? */
    .ac-actions {
        display: flex;
        align-items: center;
        gap: 0.7rem;
        padding: 1.1rem 1.4rem;
        border-top: 1px solid var(--border);
        background: rgba(255,255,255,0.012);
        flex-wrap: wrap;
    }

    .ac-btn-save {
        display: inline-flex;
        align-items: center;
        gap: 0.45rem;
        font-size: 0.88rem;
        font-weight: 700;
        letter-spacing: 0.03em;
        padding: 0.65rem 1.4rem;
        border-radius: 9px;
        border: none;
        background: linear-gradient(135deg, var(--amber-deep), var(--amber));
        color: #0f1623;
        cursor: pointer;
        font-family: 'DM Sans', sans-serif;
        box-shadow: 0 4px 14px rgba(245,158,11,0.28);
        transition: filter 0.18s, transform 0.15s;
    }

    .ac-btn-save:hover {
        filter: brightness(1.08);
        transform: translateY(-1px);
    }

    .ac-btn-cancel {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        font-size: 0.85rem;
        font-weight: 500;
        padding: 0.63rem 1.1rem;
        border-radius: 9px;
        border: 1px solid var(--border);
        background: rgba(255,255,255,0.03);
        color: var(--muted2);
        text-decoration: none;
        font-family: 'DM Sans', sans-serif;
        transition: color 0.18s, background 0.18s, border-color 0.18s;
    }

    .ac-btn-cancel:hover {
        color: var(--text);
        background: rgba(255,255,255,0.06);
        border-color: rgba(255,255,255,0.12);
    }
</style>

<!-- Page header -->
<div class="ac-header">
    <div>
        <h1 class="ac-header__title">Add New Car</h1>
        <div class="ac-header__sub">Fill in the details below to add a new listing to inventory</div>
    </div>
    <a asp-controller="Admin" asp-action="Cars" class="ac-back">
        <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 5l-7 7 7 7"/></svg>
        Back to Cars
    </a>
</div>

<!-- Form panel -->
<div class="ac-panel">
    <div class="ac-panel__head">
        <div class="ac-panel__icon">
            <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 14.5V16a1 1 0 0 0 1 1h1a2 2 0 1 0 4 0h4a2 2 0 1 0 4 0h1a1 1 0 0 0 1-1v-1.5l-1.2-4.1A2 2 0 0 0 16.9 9H7.1a2 2 0 0 0-1.9 1.4L4 14.5Z"/>
                <path d="M7.5 9 9 6.8A1.5 1.5 0 0 1 10.2 6h3.6A1.5 1.5 0 0 1 15 6.8L16.5 9"/>
            </svg>
        </div>
        <h3 class="ac-panel__title">Car Details</h3>
    </div>

    <form asp-controller="Admin" asp-action="AddCar" method="post" enctype="multipart/form-data" novalidate>
        <div class="ac-panel__body">
            <partial name="_CarForm" model="Model" />
        </div>

        <div class="ac-actions">
            <button type="submit" class="ac-btn-save">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                Save Car
            </button>
            <a asp-controller="Admin" asp-action="Cars" class="ac-btn-cancel">
                <svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                Cancel
            </a>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        (function () {
            const addRowButton = document.getElementById("addImageRowBtn");
            const rowsHost = document.getElementById("imageUploadRows");
            const rowTemplate = document.getElementById("imageUploadRowTemplate");
            if (!addRowButton || !rowsHost || !rowTemplate) return;

            const maxRows = 10;

            addRowButton.addEventListener("click", () => addRow());

            rowsHost.addEventListener("change", function (e) {
                const input = e.target.closest(".js-image-input");
                if (!input) return;
                const row = input.closest(".upload-row");
                if (!row) return;
                updateRowPreview(row, input.files?.[0] ?? null);
            });

            rowsHost.addEventListener("click", function (e) {
                const removeBtn = e.target.closest(".js-remove-row");
                if (!removeBtn) return;
                const row = removeBtn.closest(".upload-row");
                if (!row) return;
                row.remove();
                ensureAtLeastOneRow();
                syncAddButtonState();
            });

            function addRow() {
                if (rowsHost.querySelectorAll(".upload-row").length >= maxRows) return;
                const node = rowTemplate.content.firstElementChild.cloneNode(true);
                rowsHost.appendChild(node);
                syncAddButtonState();
            }

            function ensureAtLeastOneRow() {
                if (rowsHost.querySelectorAll(".upload-row").length === 0) addRow();
            }

            function syncAddButtonState() {
                addRowButton.disabled = rowsHost.querySelectorAll(".upload-row").length >= maxRows;
            }

            function updateRowPreview(row, file) {
                const thumb = row.querySelector(".upload-row-thumb");
                const name  = row.querySelector(".upload-row-file");
                if (!thumb || !name) return;
                if (!file) {
                    thumb.classList.add("d-none");
                    thumb.removeAttribute("src");
                    name.textContent = "No image selected";
                    return;
                }
                thumb.src = URL.createObjectURL(file);
                thumb.classList.remove("d-none");
                name.textContent = file.name;
            }

            ensureAtLeastOneRow();
            syncAddButtonState();
        })();
    </script>
}
