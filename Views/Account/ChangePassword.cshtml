@model MotorsHut.Models.Admin.ChangePasswordViewModel
@{
    ViewData["Title"] = "Change Password";
    Layout = "_AdminLayout";
}

<style>
    /* ── Page wrapper ─────────────────────────────── */
    .cp-wrap {
        max-width: 520px;
        margin: 0 auto;
    }

    /* ── Page header ──────────────────────────────── */
    .cp-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .cp-header__icon {
        width: 48px;
        height: 48px;
        border-radius: 14px;
        background: var(--amber-glow);
        border: 1px solid rgba(245, 158, 11, 0.22);
        display: grid;
        place-items: center;
        flex-shrink: 0;
    }

    .cp-header__icon svg {
        width: 22px;
        height: 22px;
        color: var(--amber);
    }

    .cp-header__title {
        font-size: 1.35rem;
        font-weight: 700;
        color: var(--text);
        margin: 0;
        line-height: 1.2;
    }

    .cp-header__sub {
        font-size: 0.82rem;
        color: var(--muted);
        margin-top: 2px;
    }

    /* ── Card ─────────────────────────────────────── */
    .cp-card {
        background: #0d1220;
        border: 1px solid rgba(255, 255, 255, 0.07);
        border-radius: 18px;
        padding: 2rem;
        box-shadow: 0 24px 60px rgba(0, 0, 0, 0.35);
        position: relative;
        overflow: hidden;
    }

    /* Subtle top glow line */
    .cp-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 10%;
        right: 10%;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(245, 158, 11, 0.4), transparent);
    }

    /* ── Validation summary ───────────────────────── */
    .cp-alert {
        background: rgba(248, 113, 113, 0.08);
        border: 1px solid rgba(248, 113, 113, 0.2);
        border-radius: 10px;
        padding: 0.75rem 1rem;
        margin-bottom: 1.5rem;
        color: #fca5a5;
        font-size: 0.875rem;
        display: flex;
        align-items: flex-start;
        gap: 0.6rem;
    }

    .cp-alert svg {
        width: 16px;
        height: 16px;
        flex-shrink: 0;
        margin-top: 1px;
        color: #f87171;
    }

    /* Hide the summary when empty */
    .cp-alert:empty { display: none; }

    /* ── Field groups ─────────────────────────────── */
    .cp-field {
        margin-bottom: 1.4rem;
    }

    .cp-field:last-of-type {
        margin-bottom: 0;
    }

    .cp-label {
        display: block;
        font-size: 0.8rem;
        font-weight: 600;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        color: var(--muted2);
        margin-bottom: 0.5rem;
    }

    .cp-input-wrap {
        position: relative;
    }

    .cp-input-icon {
        position: absolute;
        left: 0.9rem;
        top: 50%;
        transform: translateY(-50%);
        width: 16px;
        height: 16px;
        color: var(--muted);
        pointer-events: none;
        transition: color 0.18s;
    }

    .cp-input {
        width: 100%;
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.09);
        border-radius: 10px;
        padding: 0.72rem 2.8rem 0.72rem 2.6rem;
        font-size: 0.9rem;
        font-family: 'DM Sans', sans-serif;
        color: var(--text);
        outline: none;
        transition: border-color 0.18s, background 0.18s, box-shadow 0.18s;
    }

    .cp-input::placeholder {
        color: var(--muted);
    }

    .cp-input:focus {
        border-color: rgba(245, 158, 11, 0.45);
        background: rgba(245, 158, 11, 0.04);
        box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
    }

    .cp-input:focus + .cp-input-icon,
    .cp-input-wrap:focus-within .cp-input-icon {
        color: var(--amber);
    }

    /* Input validation states */
    .cp-input.input-error {
        border-color: rgba(248, 113, 113, 0.5);
        background: rgba(248, 113, 113, 0.04);
    }

    /* Toggle visibility button */
    .cp-eye {
        position: absolute;
        right: 0.8rem;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        color: var(--muted);
        padding: 0.2rem;
        display: grid;
        place-items: center;
        transition: color 0.18s;
    }

    .cp-eye:hover { color: var(--muted2); }
    .cp-eye svg { width: 16px; height: 16px; }

    .cp-field-error {
        font-size: 0.78rem;
        color: #f87171;
        margin-top: 0.4rem;
        display: flex;
        align-items: center;
        gap: 0.3rem;
    }

    /* ── Divider ──────────────────────────────────── */
    .cp-divider {
        height: 1px;
        background: rgba(255, 255, 255, 0.06);
        margin: 1.6rem 0;
    }

    /* ── Strength meter (new password) ───────────── */
    .cp-strength {
        margin-top: 0.55rem;
        display: flex;
        align-items: center;
        gap: 0.6rem;
    }

    .cp-strength__bars {
        display: flex;
        gap: 3px;
        flex: 1;
    }

    .cp-strength__bar {
        height: 3px;
        flex: 1;
        border-radius: 99px;
        background: rgba(255,255,255,0.08);
        transition: background 0.3s;
    }

    .cp-strength__bar.active-weak    { background: #f87171; }
    .cp-strength__bar.active-fair    { background: #fbbf24; }
    .cp-strength__bar.active-good    { background: #34d399; }
    .cp-strength__bar.active-strong  { background: #10b981; }

    .cp-strength__label {
        font-size: 0.72rem;
        color: var(--muted);
        min-width: 46px;
        text-align: right;
        font-weight: 600;
        transition: color 0.3s;
    }

    /* ── Submit button ────────────────────────────── */
    .cp-submit {
        width: 100%;
        margin-top: 1.8rem;
        padding: 0.82rem;
        background: linear-gradient(135deg, var(--amber-deep), var(--amber));
        border: none;
        border-radius: 11px;
        font-size: 0.92rem;
        font-weight: 700;
        font-family: 'DM Sans', sans-serif;
        color: #0f1623;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.55rem;
        letter-spacing: 0.02em;
        box-shadow: 0 8px 24px rgba(245, 158, 11, 0.25);
        transition: transform 0.18s, box-shadow 0.18s, filter 0.18s;
    }

    .cp-submit:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 30px rgba(245, 158, 11, 0.35);
        filter: brightness(1.06);
    }

    .cp-submit:active {
        transform: translateY(0);
    }

    .cp-submit svg {
        width: 17px;
        height: 17px;
    }

    /* ── Tip box ──────────────────────────────────── */
    .cp-tip {
        margin-top: 1.4rem;
        background: rgba(255, 255, 255, 0.025);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 11px;
        padding: 0.85rem 1rem;
        display: flex;
        gap: 0.7rem;
        align-items: flex-start;
    }

    .cp-tip svg {
        width: 15px;
        height: 15px;
        color: var(--amber);
        flex-shrink: 0;
        margin-top: 1px;
    }

    .cp-tip__text {
        font-size: 0.78rem;
        color: var(--muted2);
        line-height: 1.6;
    }

    .cp-tip__text strong {
        color: var(--text);
        font-weight: 600;
    }
</style>

<div class="cp-wrap">

    <!-- Page header -->
    <div class="cp-header">
        <div class="cp-header__icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="11" width="18" height="11" rx="2"/>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
            </svg>
        </div>
        <div>
            <h1 class="cp-header__title">Change Password</h1>
            <p class="cp-header__sub">Update your admin account credentials</p>
        </div>
    </div>

    <!-- Card -->
    <div class="cp-card">

        <form asp-action="ChangePassword" asp-controller="Account" method="post" novalidate id="cpForm">

            <!-- Validation summary -->
            <div asp-validation-summary="ModelOnly" class="cp-alert">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                <span></span>
            </div>

            <!-- Current password -->
            <div class="cp-field">
                <label asp-for="CurrentPassword" class="cp-label">Current Password</label>
                <div class="cp-input-wrap">
                    <input asp-for="CurrentPassword"
                           class="cp-input"
                           type="password"
                           placeholder="Enter your current password"
                           id="currentPwd" />
                    <svg class="cp-input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                    </svg>
                    <button type="button" class="cp-eye" onclick="togglePwd('currentPwd', this)" aria-label="Toggle visibility">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>
                        </svg>
                    </button>
                </div>
                <span asp-validation-for="CurrentPassword" class="cp-field-error"></span>
            </div>

            <div class="cp-divider"></div>

            <!-- New password -->
            <div class="cp-field">
                <label asp-for="NewPassword" class="cp-label">New Password</label>
                <div class="cp-input-wrap">
                    <input asp-for="NewPassword"
                           class="cp-input"
                           type="password"
                           placeholder="Create a strong new password"
                           id="newPwd"
                           oninput="updateStrength(this.value)" />
                    <svg class="cp-input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    </svg>
                    <button type="button" class="cp-eye" onclick="togglePwd('newPwd', this)" aria-label="Toggle visibility">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>
                        </svg>
                    </button>
                </div>
                <!-- Strength meter -->
                <div class="cp-strength" id="strengthMeter" style="display:none">
                    <div class="cp-strength__bars">
                        <div class="cp-strength__bar" id="sb1"></div>
                        <div class="cp-strength__bar" id="sb2"></div>
                        <div class="cp-strength__bar" id="sb3"></div>
                        <div class="cp-strength__bar" id="sb4"></div>
                    </div>
                    <span class="cp-strength__label" id="strengthLabel"></span>
                </div>
                <span asp-validation-for="NewPassword" class="cp-field-error"></span>
            </div>

            <!-- Confirm password -->
            <div class="cp-field">
                <label asp-for="ConfirmPassword" class="cp-label">Confirm New Password</label>
                <div class="cp-input-wrap">
                    <input asp-for="ConfirmPassword"
                           class="cp-input"
                           type="password"
                           placeholder="Repeat your new password"
                           id="confirmPwd" />
                    <svg class="cp-input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                    </svg>
                    <button type="button" class="cp-eye" onclick="togglePwd('confirmPwd', this)" aria-label="Toggle visibility">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>
                        </svg>
                    </button>
                </div>
                <span asp-validation-for="ConfirmPassword" class="cp-field-error"></span>
            </div>

            <!-- Submit -->
            <button type="submit" class="cp-submit">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v14a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/>
                </svg>
                Update Password
            </button>

        </form>

        <!-- Tip box -->
        <div class="cp-tip">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
            <p class="cp-tip__text">
                Use <strong>8+ characters</strong> with a mix of uppercase, lowercase, numbers, and symbols for a strong password.
            </p>
        </div>

    </div><!-- /.cp-card -->
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        // Toggle password visibility
        function togglePwd(inputId, btn) {
            const input = document.getElementById(inputId);
            const isHidden = input.type === 'password';
            input.type = isHidden ? 'text' : 'password';
            btn.innerHTML = isHidden
                ? `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
                       <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94"/>
                       <path d="M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"/>
                       <line x1="1" y1="1" x2="23" y2="23"/>
                   </svg>`
                : `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
                       <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>
                   </svg>`;
        }

        // Password strength meter
        function updateStrength(value) {
            const meter = document.getElementById('strengthMeter');
            const label = document.getElementById('strengthLabel');
            const bars  = [document.getElementById('sb1'), document.getElementById('sb2'),
                           document.getElementById('sb3'), document.getElementById('sb4')];

            if (!value) { meter.style.display = 'none'; return; }
            meter.style.display = 'flex';

            let score = 0;
            if (value.length >= 8)               score++;
            if (/[A-Z]/.test(value))             score++;
            if (/[0-9]/.test(value))             score++;
            if (/[^A-Za-z0-9]/.test(value))      score++;

            const levels = ['', 'Weak', 'Fair', 'Good', 'Strong'];
            const cls    = ['', 'active-weak', 'active-fair', 'active-good', 'active-strong'];
            const colors = ['', '#f87171', '#fbbf24', '#34d399', '#10b981'];

            bars.forEach((b, i) => {
                b.className = 'cp-strength__bar' + (i < score ? ` ${cls[score]}` : '');
            });

            label.textContent = levels[score];
            label.style.color = colors[score];
        }
    </script>
}
